<!doctype html>
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Generator haseł</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }
      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        background: radial-gradient(1000px 600px at 10% 10%, #e9f2ff 0%, #f7f7f7 45%, #ffffff 100%);
        color: #111;
      }
      .card {
        width: min(720px, 92vw);
        padding: 32px;
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        display: grid;
        gap: 16px;
      }
      h1 {
        margin: 0;
        font-size: 24px;
      }
      .password {
        font-size: clamp(20px, 3vw, 30px);
        font-weight: 700;
        letter-spacing: 0.5px;
        word-break: break-word;
        padding: 16px;
        border-radius: 12px;
        background: #f1f5ff;
        border: 1px solid #d7e0ff;
      }
      .transcription {
        font-size: clamp(14px, 2vw, 18px);
        font-weight: 600;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }
      button {
        border: 0;
        padding: 10px 16px;
        border-radius: 10px;
        background: #3b6ef5;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }
      button:hover {
        background: #2f5fe0;
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .muted {
        color: #666;
        font-size: 14px;
      }
      .footer {
        font-size: 13px;
      }
      @media (prefers-color-scheme: dark) {
        body {
          background: radial-gradient(1000px 600px at 10% 10%, #1b2433 0%, #0f1117 50%, #0b0d12 100%);
          color: #f5f5f5;
        }
        .card {
          background: rgba(18, 20, 26, 0.9);
          box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
        }
        .password {
          background: #141a24;
          border-color: #25314b;
        }
        .muted {
          color: #aab0bb;
        }
      }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>Generator haseł</h1>
      <div id="password" class="password" aria-live="polite">Ładowanie…</div>
      <div id="transcription" class="password transcription" aria-live="polite">Transkrypcja…</div>
      <div class="row">
        <button id="regen" type="button">Wygeneruj ponownie</button>
        <button id="copy" type="button" disabled>Skopiuj hasło</button>
        <span class="muted">Hasło składa się z 4 słów, cyfry i znaku specjalnego.</span>
      </div>
      <footer class="muted footer">Strona nie przechowuje wygenerowanych haseł.</footer>
    </main>

    <script>
      const WORDS_URL = "slowa.txt";
      const DIGITS = "0123456789";
      const SPECIALS = "!@#$%^&*()-_=+[]{};:,.?/|";

      const passwordEl = document.getElementById("password");
      const transcriptionEl = document.getElementById("transcription");
      const regenBtn = document.getElementById("regen");
      const copyBtn = document.getElementById("copy");

      let words = [];

      const randomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];

      const normalizeWord = (word) =>
        Math.random() < 0.5 ? word.toLowerCase() : word.toUpperCase();

      const ICAO_PL = {
        a: "Adam",
        b: "Barbara",
        c: "Celina",
        d: "Dorota",
        e: "Ewa",
        f: "Franciszek",
        g: "Genowefa",
        h: "Henryk",
        i: "Irena",
        j: "Józef",
        k: "Karol",
        l: "Leon",
        m: "Maria",
        n: "Natalia",
        o: "Olga",
        p: "Paweł",
        q: "Quiryn",
        r: "Roman",
        s: "Stefan",
        t: "Tadeusz",
        u: "Urszula",
        v: "Violetta",
        w: "Wanda",
        x: "Xawery",
        y: "Yvonne",
        z: "Zenon",
      };

      const DIGIT_NAMES_PL = {
        0: "zero",
        1: "jeden",
        2: "dwa",
        3: "trzy",
        4: "cztery",
        5: "pięć",
        6: "sześć",
        7: "siedem",
        8: "osiem",
        9: "dziewięć",
      };

      const stripDiacritics = (value) =>
        value.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

      const transcribePassword = (value) => {
        const normalized = stripDiacritics(value);
        const parts = [];

        for (let i = 0; i < normalized.length; i += 1) {
          const originalChar = value[i];
          const ch = normalized[i];
          const lower = ch.toLowerCase();

          if (ICAO_PL[lower]) {
            const isUpper = originalChar === originalChar.toUpperCase();
            const sizeLabel = isUpper ? "duża" : "mała";
            parts.push(`${sizeLabel} ${ICAO_PL[lower]}`);
          } else if (DIGIT_NAMES_PL[lower]) {
            parts.push(`cyfra ${DIGIT_NAMES_PL[lower]}`);
          } else {
            parts.push(`znak ${ch}`);
          }
        }

        return parts.join(" | ");
      };

      const generatePassword = () => {
        if (!words.length) {
          passwordEl.textContent = "Brak słów do losowania.";
          transcriptionEl.textContent = "Transkrypcja niedostępna.";
          copyBtn.disabled = true;
          return;
        }

        if (words.length < 4) {
          passwordEl.textContent = "Za mało słów do losowania (wymagane 4).";
          transcriptionEl.textContent = "Transkrypcja niedostępna.";
          copyBtn.disabled = true;
          return;
        }

        const pool = [...words];
        const selected = [];
        for (let i = 0; i < 4; i += 1) {
          const index = Math.floor(Math.random() * pool.length);
          selected.push(pool.splice(index, 1)[0]);
        }

        const separators = Array.from({ length: 3 }, () => {
          const useDigit = Math.random() < 0.5;
          return useDigit ? randomItem(DIGITS) : randomItem(SPECIALS);
        });

        const parts = selected.map(normalizeWord);
        let password = parts[0];
        for (let i = 0; i < separators.length; i += 1) {
          password += `${separators[i]}${parts[i + 1]}`;
        }

        passwordEl.textContent = password;
        transcriptionEl.textContent = transcribePassword(password);
        copyBtn.disabled = false;
      };

      const copyPassword = async () => {
        const text = passwordEl.textContent?.trim();
        if (!text || text === "Ładowanie…") return;

        try {
          if (navigator.clipboard?.writeText) {
            await navigator.clipboard.writeText(text);
          } else {
            const textarea = document.createElement("textarea");
            textarea.value = text;
            textarea.setAttribute("readonly", "");
            textarea.style.position = "absolute";
            textarea.style.left = "-9999px";
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
          }

          const previous = copyBtn.textContent;
          copyBtn.textContent = "Skopiowano!";
          setTimeout(() => {
            copyBtn.textContent = previous;
          }, 1200);
        } catch {
          const previous = copyBtn.textContent;
          copyBtn.textContent = "Nie udało się";
          setTimeout(() => {
            copyBtn.textContent = previous;
          }, 1200);
        }
      };

      const loadWords = async () => {
        const response = await fetch(WORDS_URL, { cache: "no-store" });
        if (!response.ok) throw new Error("Nie udało się wczytać słów.");

        const text = await response.text();
        words = text
          .split(/\r?\n/)
          .map((w) => w.trim())
          .filter(Boolean);
      };

      regenBtn.addEventListener("click", generatePassword);
      copyBtn.addEventListener("click", copyPassword);

      loadWords()
        .then(generatePassword)
        .catch(() => {
          passwordEl.textContent = "Błąd wczytywania pliku slowa.txt";
          transcriptionEl.textContent = "Transkrypcja niedostępna.";
          copyBtn.disabled = true;
        });
    </script>
  </body>
</html>
