<!doctype html>
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Generator haseł</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      }
      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        background: radial-gradient(1000px 600px at 10% 10%, #e9f2ff 0%, #f7f7f7 45%, #ffffff 100%);
        color: #111;
      }
      .card {
        width: min(720px, 92vw);
        padding: 32px;
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        display: grid;
        gap: 16px;
      }
      .password-grid {
        display: grid;
        gap: 16px;
      }
      .password-card {
        padding: 16px;
        border-radius: 12px;
        border: 1px solid #d7e0ff;
        background: #f8faff;
        display: grid;
        gap: 12px;
      }
      h1 {
        margin: 0;
        font-size: 24px;
      }
      h2 {
        margin: 0;
        font-size: 18px;
      }
      .password {
        font-size: clamp(20px, 3vw, 30px);
        font-weight: 700;
        letter-spacing: 0.5px;
        word-break: break-word;
        padding: 16px;
        border-radius: 12px;
        background: #f1f5ff;
        border: 1px solid #d7e0ff;
      }
      .transcription {
        font-size: clamp(14px, 2vw, 18px);
        font-weight: 600;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }
      button {
        border: 0;
        padding: 10px 16px;
        border-radius: 10px;
        background: #3b6ef5;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }
      button:hover {
        background: #2f5fe0;
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .muted {
        color: #666;
        font-size: 14px;
      }
      .footer {
        font-size: 13px;
      }
      @media (prefers-color-scheme: dark) {
        body {
          background: radial-gradient(1000px 600px at 10% 10%, #1b2433 0%, #0f1117 50%, #0b0d12 100%);
          color: #f5f5f5;
        }
        .card {
          background: rgba(18, 20, 26, 0.9);
          box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
        }
        .password-card {
          background: #121821;
          border-color: #25314b;
        }
        .password {
          background: #141a24;
          border-color: #25314b;
        }
        .muted {
          color: #aab0bb;
        }
      }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>Generator haseł</h1>
      <p class="muted">Cztery propozycje haseł o różnych długościach. Każda propozycja ma własną transkrypcję.</p>
      <div class="password-grid">
        <section class="password-card" aria-live="polite">
          <h2>Hasło dobre (bez polskich diakrytycznych)</h2>
          <div id="password-ascii" class="password">Ładowanie…</div>
          <div id="transcription-ascii" class="password transcription">Transkrypcja…</div>
          <div id="length-ascii" class="muted">Długość hasła: —</div>
          <button class="copy-btn" type="button" data-copy="ascii" disabled>Skopiuj hasło</button>
        </section>
        <section class="password-card" aria-live="polite">
          <h2>Hasło krótkie</h2>
          <div id="password-short" class="password">Ładowanie…</div>
          <div id="transcription-short" class="password transcription">Transkrypcja…</div>
          <div id="length-short" class="muted">Długość hasła: —</div>
          <button class="copy-btn" type="button" data-copy="short" disabled>Skopiuj hasło</button>
        </section>
        <section class="password-card" aria-live="polite">
          <h2>Hasło średnie</h2>
          <div id="password-medium" class="password">Ładowanie…</div>
          <div id="transcription-medium" class="password transcription">Transkrypcja…</div>
          <div id="length-medium" class="muted">Długość hasła: —</div>
          <button class="copy-btn" type="button" data-copy="medium" disabled>Skopiuj hasło</button>
        </section>
        <section class="password-card" aria-live="polite">
          <h2>Hasło długie</h2>
          <div id="password-long" class="password">Ładowanie…</div>
          <div id="transcription-long" class="password transcription">Transkrypcja…</div>
          <div id="length-long" class="muted">Długość hasła: —</div>
          <button class="copy-btn" type="button" data-copy="long" disabled>Skopiuj hasło</button>
        </section>
      </div>
      <div class="row">
        <button id="regen" type="button">Wygeneruj ponownie</button>
        <span class="muted">Hasła zawierają cyfrę oraz znak specjalny.</span>
      </div>
      <footer class="muted footer">
        Strona nie przechowuje wygenerowanych haseł. Repozytorium:
        <a href="https://github.com/enclude/www.hasla.zjawa.it" target="_blank" rel="noopener noreferrer">github.com/enclude/www.hasla.zjawa.it</a>.
        Licencja: CC BY 4.0 — wymagane wskazanie źródła i twórcy.
      </footer>
    </main>

    <script>
      const WORDS_URL = "slowa.txt";
      const DIGITS = "0123456789";
      const SPECIALS = "!@#$%^&*()-_=+[]{};:,.?/|";

      const regenBtn = document.getElementById("regen");
      const copyButtons = Array.from(document.querySelectorAll(".copy-btn"));

      let words = [];

      const randomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];

      const normalizeWord = (word, forceCase) => {
        if (forceCase === "lower") return word.toLowerCase();
        if (forceCase === "upper") return word.toUpperCase();
        return Math.random() < 0.5 ? word.toLowerCase() : word.toUpperCase();
      };

      const ICAO_PL = {
        a: "Adam",
        b: "Barbara",
        c: "Celina",
        d: "Dorota",
        e: "Ewa",
        f: "Franciszek",
        g: "Genowefa",
        h: "Henryk",
        i: "Irena",
        j: "Józef",
        k: "Karol",
        l: "Leon",
        m: "Maria",
        n: "Natalia",
        o: "Olga",
        p: "Paweł",
        q: "Quiryn",
        r: "Roman",
        s: "Stefan",
        t: "Tadeusz",
        u: "Urszula",
        v: "Violetta",
        w: "Wanda",
        x: "Xawery",
        y: "Yvonne",
        z: "Zenon",
      };

      const DIGIT_NAMES_PL = {
        0: "zero",
        1: "jeden",
        2: "dwa",
        3: "trzy",
        4: "cztery",
        5: "pięć",
        6: "sześć",
        7: "siedem",
        8: "osiem",
        9: "dziewięć",
      };

      const stripDiacritics = (value) =>
        value.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

      const transcribePassword = (value) => {
        const normalized = stripDiacritics(value);
        const parts = [];

        for (let i = 0; i < normalized.length; i += 1) {
          const originalChar = value[i];
          const ch = normalized[i];
          const lower = ch.toLowerCase();

          if (ICAO_PL[lower]) {
            const isUpper = originalChar === originalChar.toUpperCase();
            const sizeLabel = isUpper ? "duża" : "mała";
            parts.push(`${sizeLabel} ${ICAO_PL[lower]}`);
          } else if (DIGIT_NAMES_PL[lower]) {
            parts.push(`cyfra ${DIGIT_NAMES_PL[lower]}`);
          } else {
            parts.push(`znak ${ch}`);
          }
        }

        return parts.join(" | ");
      };

      const ensureDigitAndSpecial = (value) => {
        let result = value;
        const hasDigit = /\d/.test(result);
        const hasSpecial = Array.from(result).some((char) =>
          SPECIALS.includes(char)
        );

        if (!hasDigit) {
          result += randomItem(DIGITS);
        }

        if (!hasSpecial) {
          result += randomItem(SPECIALS);
        }

        return result;
      };

      const variants = [
        { key: "short", min: 8, max: 12, strip: false },
        { key: "medium", min: 13, max: 16, strip: false },
        { key: "long", min: 17, max: 24, strip: false },
        { key: "ascii", min: 18, max: 26, strip: true },
      ];

      const getElementsFor = (key) => ({
        password: document.getElementById(`password-${key}`),
        transcription: document.getElementById(`transcription-${key}`),
        length: document.getElementById(`length-${key}`),
        copy: document.querySelector(`.copy-btn[data-copy="${key}"]`),
      });

      const buildPassword = (minLength, maxLength, strip) => {
        if (words.length < 2) {
          return null;
        }

        const attempts = 200;
        for (let attempt = 0; attempt < attempts; attempt += 1) {
          const wordCount = Math.min(
            words.length,
            Math.floor(Math.random() * 3) + 2
          );
          const pool = [...words];
          const selected = [];
          for (let i = 0; i < wordCount; i += 1) {
            const index = Math.floor(Math.random() * pool.length);
            selected.push(pool.splice(index, 1)[0]);
          }

          const separators = Array.from({ length: wordCount - 1 }, () => {
            const useDigit = Math.random() < 0.5;
            return useDigit ? randomItem(DIGITS) : randomItem(SPECIALS);
          });

          const cases = Array(selected.length).fill(null);
          const lowerIndex = Math.floor(Math.random() * selected.length);
          let upperIndex = Math.floor(Math.random() * selected.length);
          while (upperIndex === lowerIndex) {
            upperIndex = Math.floor(Math.random() * selected.length);
          }
          cases[lowerIndex] = "lower";
          cases[upperIndex] = "upper";

          const parts = selected.map((word, index) =>
            normalizeWord(word, cases[index])
          );
          let password = parts[0];
          for (let i = 0; i < separators.length; i += 1) {
            password += `${separators[i]}${parts[i + 1]}`;
          }

          if (strip) {
            password = stripDiacritics(password);
          }

          password = ensureDigitAndSpecial(password);

          if (password.length >= minLength && password.length <= maxLength) {
            return password;
          }
        }

        return null;
      };

      const generatePasswords = () => {
        if (!words.length) {
          variants.forEach(({ key }) => {
            const elements = getElementsFor(key);
            elements.password.textContent = "Brak słów do losowania.";
            elements.transcription.textContent = "Transkrypcja niedostępna.";
            elements.length.textContent = "Długość hasła: —";
            elements.copy.disabled = true;
          });
          return;
        }

        if (words.length < 2) {
          variants.forEach(({ key }) => {
            const elements = getElementsFor(key);
            elements.password.textContent = "Za mało słów do losowania.";
            elements.transcription.textContent = "Transkrypcja niedostępna.";
            elements.length.textContent = "Długość hasła: —";
            elements.copy.disabled = true;
          });
          return;
        }

        variants.forEach(({ key, min, max, strip }) => {
          const elements = getElementsFor(key);
          const password = buildPassword(min, max, strip);

          if (!password) {
            elements.password.textContent = "Nie udało się wygenerować hasła w tym zakresie.";
            elements.transcription.textContent = "Transkrypcja niedostępna.";
            elements.length.textContent = "Długość hasła: —";
            elements.copy.disabled = true;
            return;
          }

          elements.password.textContent = password;
          elements.transcription.textContent = transcribePassword(password);
          elements.length.textContent = `Długość hasła: ${password.length} znaków`;
          elements.copy.disabled = false;
        });
      };

      const copyPassword = async (key) => {
        const elements = getElementsFor(key);
        const text = elements.password.textContent?.trim();
        if (!text || text === "Ładowanie…") return;

        try {
          if (navigator.clipboard?.writeText) {
            await navigator.clipboard.writeText(text);
          } else {
            const textarea = document.createElement("textarea");
            textarea.value = text;
            textarea.setAttribute("readonly", "");
            textarea.style.position = "absolute";
            textarea.style.left = "-9999px";
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
          }

          const previous = elements.copy.textContent;
          elements.copy.textContent = "Skopiowano!";
          setTimeout(() => {
            elements.copy.textContent = previous;
          }, 1200);
        } catch {
          const previous = elements.copy.textContent;
          elements.copy.textContent = "Nie udało się";
          setTimeout(() => {
            elements.copy.textContent = previous;
          }, 1200);
        }
      };

      const loadWords = async () => {
        const response = await fetch(WORDS_URL, { cache: "no-store" });
        if (!response.ok) throw new Error("Nie udało się wczytać słów.");

        const text = await response.text();
        words = text
          .split(/\r?\n/)
          .map((w) => w.trim())
          .filter(Boolean);
      };

      regenBtn.addEventListener("click", generatePasswords);
      copyButtons.forEach((button) => {
        button.addEventListener("click", () => {
          const key = button.dataset.copy;
          if (key) copyPassword(key);
        });
      });

      loadWords()
        .then(generatePasswords)
        .catch(() => {
          variants.forEach(({ key }) => {
            const elements = getElementsFor(key);
            elements.password.textContent = "Błąd wczytywania pliku slowa.txt";
            elements.transcription.textContent = "Transkrypcja niedostępna.";
            elements.length.textContent = "Długość hasła: —";
            elements.copy.disabled = true;
          });
        });
    </script>
  </body>
</html>
